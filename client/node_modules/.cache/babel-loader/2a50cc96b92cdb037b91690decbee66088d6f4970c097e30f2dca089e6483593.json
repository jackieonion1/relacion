{"ast":null,"code":"var _jsxFileName = \"/Users/sebastianfornelli/XcodeProjects/Relacion/CascadeProjects/windsurf-project/client/src/pages/Calendar.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { addEvent, listEvents, deleteEvent } from '../lib/calendar';\nimport Modal from '../components/Modal';\nimport EventTypeSwitcher from '../components/EventTypeSwitcher';\nimport ViewSwitcher from '../components/ViewSwitcher';\nimport MonthlyCalendarView from '../components/MonthlyCalendarView';\nimport CollapsibleSection from '../components/CollapsibleSection';\nimport HeartRainAnimation from '../components/HeartRainAnimation';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst EventList = ({\n  events,\n  onDelete\n}) => {\n  if (events.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-gray-500 text-sm px-4 py-2\",\n      children: \"No hay eventos aqu\\xED.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"ul\", {\n    className: \"divide-y divide-rose-100\",\n    children: events.map(ev => {\n      var _ev$start, _ev$start$toDate, _ev$end, _ev$end$toDate;\n      const startDate = ((_ev$start = ev.start) === null || _ev$start === void 0 ? void 0 : (_ev$start$toDate = _ev$start.toDate) === null || _ev$start$toDate === void 0 ? void 0 : _ev$start$toDate.call(_ev$start)) || null;\n      const endDate = ((_ev$end = ev.end) === null || _ev$end === void 0 ? void 0 : (_ev$end$toDate = _ev$end.toDate) === null || _ev$end$toDate === void 0 ? void 0 : _ev$end$toDate.call(_ev$end)) || null;\n      let when = '';\n      if (startDate) {\n        const startStr = startDate.toLocaleString([], {\n          dateStyle: 'medium',\n          timeStyle: 'short'\n        });\n        if (endDate && endDate.toDateString() !== startDate.toDateString()) {\n          // Multi-day event: show date range\n          const endStr = endDate.toLocaleString([], {\n            dateStyle: 'medium',\n            timeStyle: 'short'\n          });\n          when = `${startStr} - ${endStr}`;\n        } else {\n          // Single day event\n          when = startStr;\n        }\n      }\n\n      // Get event type color\n      let eventTypeColor = 'bg-rose-500'; // Default: conjunto (pink)\n      if (ev.eventType === 'novio') {\n        eventTypeColor = 'bg-yellow-500';\n      } else if (ev.eventType === 'novia') {\n        eventTypeColor = 'bg-purple-500';\n      }\n      return /*#__PURE__*/_jsxDEV(\"li\", {\n        className: \"py-3 flex items-center gap-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 min-w-0\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-medium text-gray-900 truncate flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"truncate\",\n              children: ev.title\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 45,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `w-2 h-2 rounded-full flex-shrink-0 ${eventTypeColor}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 46,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500 truncate\",\n            children: [when, ev.location ? ` · ${ev.location}` : '']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 48,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 43,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => onDelete(ev.id),\n          className: \"btn-link text-sm\",\n          children: \"Borrar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 50,\n          columnNumber: 13\n        }, this)]\n      }, ev.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 11\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 15,\n    columnNumber: 5\n  }, this);\n};\n_c = EventList;\nexport default function CalendarPage() {\n  _s();\n  const [view, setView] = useState('Lista'); // 'Lista' | 'Calendario'\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const pairId = useMemo(() => localStorage.getItem('pairId') || '', []);\n  const identity = useMemo(() => localStorage.getItem('identity') || 'yo', []);\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshKey, setRefreshKey] = useState(0);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState('');\n  const [selectedEventType, setSelectedEventType] = useState('conjunto');\n  const [selectedDay, setSelectedDay] = useState(null);\n  const [dayEventsPopup, setDayEventsPopup] = useState(false);\n  const [showHeartRain, setShowHeartRain] = useState(false);\n  const [heartAnimationType, setHeartAnimationType] = useState('rain');\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      try {\n        const list = await listEvents(pairId, {\n          futureOnly: false,\n          max: 100\n        });\n        if (!cancelled) setItems(list);\n      } catch (e) {\n        if (!cancelled) setError('Sin conexión o sin permisos.');\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, [pairId, refreshKey]);\n  const {\n    upcomingEvents,\n    pastEvents\n  } = useMemo(() => {\n    const now = new Date();\n    const upcoming = [];\n    const past = [];\n    const sortedItems = [...items].sort((a, b) => {\n      var _a$start, _a$start$toMillis, _b$start, _b$start$toMillis;\n      return (((_a$start = a.start) === null || _a$start === void 0 ? void 0 : (_a$start$toMillis = _a$start.toMillis) === null || _a$start$toMillis === void 0 ? void 0 : _a$start$toMillis.call(_a$start)) || 0) - (((_b$start = b.start) === null || _b$start === void 0 ? void 0 : (_b$start$toMillis = _b$start.toMillis) === null || _b$start$toMillis === void 0 ? void 0 : _b$start$toMillis.call(_b$start)) || 0);\n    });\n    for (const event of sortedItems) {\n      var _event$start;\n      if ((((_event$start = event.start) === null || _event$start === void 0 ? void 0 : _event$start.toDate()) || 0) >= now) {\n        upcoming.push(event);\n      } else {\n        past.push(event);\n      }\n    }\n    return {\n      upcomingEvents: upcoming,\n      pastEvents: past.reverse()\n    };\n  }, [items]);\n  async function onAdd(e) {\n    e.preventDefault();\n    const {\n      title,\n      location,\n      date,\n      time,\n      endDate\n    } = Object.fromEntries(new FormData(e.currentTarget));\n    if (!title || !date) return;\n    setSaving(true);\n    setError('');\n\n    // Call addEvent and close popup regardless of result\n    addEvent(pairId, {\n      title,\n      date,\n      time,\n      endDate,\n      location,\n      eventType: selectedEventType\n    }, identity);\n    e.currentTarget.reset();\n    setSelectedEventType('conjunto'); // Reset to default\n    setIsModalOpen(false);\n    setSaving(false);\n    setRefreshKey(k => k + 1); // Force a reliable refetch\n  }\n  const onDelete = async id => {\n    if (!window.confirm('¿Borrar evento?')) return;\n    try {\n      await deleteEvent(pairId, id);\n      setRefreshKey(k => k + 1);\n    } catch (e) {\n      alert('Error al borrar');\n    }\n  };\n  const onDayClick = (day, month, year) => {\n    setSelectedDay({\n      day,\n      month,\n      year\n    });\n    setDayEventsPopup(true);\n\n    // Special celebration for day 24 (anniversary day)\n    if (day === 24) {\n      setShowHeartRain(true);\n      // Stop animation after 2 seconds\n      setTimeout(() => setShowHeartRain(false), 2000);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"space-y-4\",\n    children: [/*#__PURE__*/_jsxDEV(ViewSwitcher, {\n      views: ['Lista', 'Calendario'],\n      activeView: view,\n      onChange: setView\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }, this), view === 'Calendario' && /*#__PURE__*/_jsxDEV(MonthlyCalendarView, {\n      events: items,\n      onDayClick: onDayClick\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 33\n    }, this), view === 'Lista' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative min-h-[60vh]\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"divide-y divide-gray-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card rounded-b-none\",\n          children: /*#__PURE__*/_jsxDEV(CollapsibleSection, {\n            title: \"Pr\\xF3ximos eventos\",\n            defaultOpen: true,\n            children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-gray-500 px-4 py-2\",\n              children: \"Cargando\\u2026\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 28\n            }, this) : /*#__PURE__*/_jsxDEV(EventList, {\n              events: upcomingEvents,\n              onDelete: onDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 87\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card rounded-t-none\",\n          children: /*#__PURE__*/_jsxDEV(CollapsibleSection, {\n            title: \"Eventos pasados\",\n            children: /*#__PURE__*/_jsxDEV(EventList, {\n              events: pastEvents,\n              onDelete: onDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setIsModalOpen(true),\n        className: \"fixed bottom-24 right-4 bg-rose-500 text-white rounded-full px-5 py-3 font-semibold shadow-lg hover:bg-rose-600 transition-transform active:scale-95\",\n        children: \"Nuevo evento\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: isModalOpen,\n      onClose: () => setIsModalOpen(false),\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: onAdd,\n        className: \"p-6 space-y-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"font-semibold text-lg\",\n          children: \"A\\xF1adir evento\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            name: \"title\",\n            placeholder: \"T\\xEDtulo\",\n            className: \"input w-full\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            name: \"location\",\n            placeholder: \"Ubicaci\\xF3n (opcional)\",\n            className: \"input w-full\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              name: \"date\",\n              type: \"date\",\n              className: \"input w-full\",\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              name: \"time\",\n              type: \"time\",\n              className: \"input w-full\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 183,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            name: \"endDate\",\n            type: \"date\",\n            className: \"input w-full\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm text-gray-600\",\n              children: \"Tipo de evento\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(EventTypeSwitcher, {\n              activeType: selectedEventType,\n              onChange: setSelectedEventType\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-xs text-rose-600\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-end gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => setIsModalOpen(false),\n            className: \"btn-ghost\",\n            children: \"Cancelar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            disabled: saving,\n            className: \"btn-primary disabled:opacity-60\",\n            children: saving ? 'Guardando…' : 'Añadir'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: dayEventsPopup,\n      onClose: () => setDayEventsPopup(false),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"font-semibold text-lg mb-4\",\n          children: selectedDay && `Eventos del ${selectedDay.day} de ${new Date(selectedDay.year, selectedDay.month).toLocaleDateString('es-ES', {\n            month: 'long',\n            year: 'numeric'\n          })}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 11\n        }, this), selectedDay && (() => {\n          // Special anniversary message for day 24\n          const isAnniversaryDay = selectedDay.day === 24;\n          let anniversaryMessage = null;\n          if (isAnniversaryDay) {\n            const anniversaryDate = new Date(2024, 10, 24); // November 24, 2024 (month is 0-indexed)\n            const selectedDate = new Date(selectedDay.year, selectedDay.month, selectedDay.day);\n\n            // Calculate months difference\n            const yearsDiff = selectedDate.getFullYear() - anniversaryDate.getFullYear();\n            const monthsDiff = selectedDate.getMonth() - anniversaryDate.getMonth();\n            const totalMonths = yearsDiff * 12 + monthsDiff;\n            if (totalMonths > 0) {\n              let message = '';\n              if (totalMonths >= 12) {\n                const years = Math.floor(totalMonths / 12);\n                const remainingMonths = totalMonths % 12;\n                if (remainingMonths === 0) {\n                  message = `¡¡${years} ${years === 1 ? 'año' : 'años'}!!`;\n                } else {\n                  message = `¡¡${years} ${years === 1 ? 'año' : 'años'} y ${remainingMonths} ${remainingMonths === 1 ? 'mes' : 'meses'}!!`;\n                }\n              } else {\n                message = `¡¡${totalMonths} ${totalMonths === 1 ? 'mes' : 'meses'}!!`;\n              }\n              anniversaryMessage = /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-200 rounded-lg p-4 mb-4 text-center\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-2xl mb-2\",\n                  children: \"\\uD83D\\uDC96\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 237,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-lg font-semibold text-pink-600 mb-1\",\n                  children: message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 238,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-sm text-pink-500\",\n                  children: \"\\xA1Feliz mesiversario!\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 241,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 19\n              }, this);\n            }\n          }\n\n          // Filter events for the selected day\n          const dayEvents = items.filter(event => {\n            var _event$start2, _event$end;\n            if (!((_event$start2 = event.start) !== null && _event$start2 !== void 0 && _event$start2.toDate)) return false;\n            const eventStart = event.start.toDate();\n            const eventEnd = ((_event$end = event.end) === null || _event$end === void 0 ? void 0 : _event$end.toDate()) || eventStart;\n            const selectedDate = new Date(selectedDay.year, selectedDay.month, selectedDay.day);\n\n            // Check if the selected date falls within the event range\n            return selectedDate >= new Date(eventStart.getFullYear(), eventStart.getMonth(), eventStart.getDate()) && selectedDate <= new Date(eventEnd.getFullYear(), eventEnd.getMonth(), eventEnd.getDate());\n          });\n          return /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [anniversaryMessage, dayEvents.length > 0 ? /*#__PURE__*/_jsxDEV(EventList, {\n              events: dayEvents,\n              onDelete: onDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 19\n            }, this) : !anniversaryMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-gray-500 text-sm py-4\",\n              children: \"No hay eventos en este d\\xEDa.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 42\n            }, this)]\n          }, void 0, true);\n        })(), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-end mt-4\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setDayEventsPopup(false),\n            className: \"btn-primary\",\n            children: \"Cerrar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(HeartRainAnimation, {\n      isActive: showHeartRain,\n      duration: 2000\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 5\n  }, this);\n}\n_s(CalendarPage, \"Mt0pdKGI+GD0igF8uukpIWQerxM=\");\n_c2 = CalendarPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"EventList\");\n$RefreshReg$(_c2, \"CalendarPage\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","addEvent","listEvents","deleteEvent","Modal","EventTypeSwitcher","ViewSwitcher","MonthlyCalendarView","CollapsibleSection","HeartRainAnimation","jsxDEV","_jsxDEV","Fragment","_Fragment","EventList","events","onDelete","length","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","ev","_ev$start","_ev$start$toDate","_ev$end","_ev$end$toDate","startDate","start","toDate","call","endDate","end","when","startStr","toLocaleString","dateStyle","timeStyle","toDateString","endStr","eventTypeColor","eventType","title","location","onClick","id","_c","CalendarPage","_s","view","setView","isModalOpen","setIsModalOpen","pairId","localStorage","getItem","identity","items","setItems","loading","setLoading","refreshKey","setRefreshKey","saving","setSaving","error","setError","selectedEventType","setSelectedEventType","selectedDay","setSelectedDay","dayEventsPopup","setDayEventsPopup","showHeartRain","setShowHeartRain","heartAnimationType","setHeartAnimationType","cancelled","list","futureOnly","max","e","upcomingEvents","pastEvents","now","Date","upcoming","past","sortedItems","sort","a","b","_a$start","_a$start$toMillis","_b$start","_b$start$toMillis","toMillis","event","_event$start","push","reverse","onAdd","preventDefault","date","time","Object","fromEntries","FormData","currentTarget","reset","k","window","confirm","alert","onDayClick","day","month","year","setTimeout","views","activeView","onChange","defaultOpen","isOpen","onClose","onSubmit","name","placeholder","required","type","activeType","disabled","toLocaleDateString","isAnniversaryDay","anniversaryMessage","anniversaryDate","selectedDate","yearsDiff","getFullYear","monthsDiff","getMonth","totalMonths","message","years","Math","floor","remainingMonths","dayEvents","filter","_event$start2","_event$end","eventStart","eventEnd","getDate","isActive","duration","_c2","$RefreshReg$"],"sources":["/Users/sebastianfornelli/XcodeProjects/Relacion/CascadeProjects/windsurf-project/client/src/pages/Calendar.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport { addEvent, listEvents, deleteEvent } from '../lib/calendar';\nimport Modal from '../components/Modal';\nimport EventTypeSwitcher from '../components/EventTypeSwitcher';\nimport ViewSwitcher from '../components/ViewSwitcher';\nimport MonthlyCalendarView from '../components/MonthlyCalendarView';\nimport CollapsibleSection from '../components/CollapsibleSection';\nimport HeartRainAnimation from '../components/HeartRainAnimation';\n\nconst EventList = ({ events, onDelete }) => {\n  if (events.length === 0) {\n    return <div className=\"text-gray-500 text-sm px-4 py-2\">No hay eventos aquí.</div>;\n  }\n  return (\n    <ul className=\"divide-y divide-rose-100\">\n      {events.map((ev) => {\n        const startDate = ev.start?.toDate?.() || null;\n        const endDate = ev.end?.toDate?.() || null;\n        \n        let when = '';\n        if (startDate) {\n          const startStr = startDate.toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' });\n          if (endDate && endDate.toDateString() !== startDate.toDateString()) {\n            // Multi-day event: show date range\n            const endStr = endDate.toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' });\n            when = `${startStr} - ${endStr}`;\n          } else {\n            // Single day event\n            when = startStr;\n          }\n        }\n        \n        // Get event type color\n        let eventTypeColor = 'bg-rose-500'; // Default: conjunto (pink)\n        if (ev.eventType === 'novio') {\n          eventTypeColor = 'bg-yellow-500';\n        } else if (ev.eventType === 'novia') {\n          eventTypeColor = 'bg-purple-500';\n        }\n        \n        return (\n          <li key={ev.id} className=\"py-3 flex items-center gap-3\">\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"font-medium text-gray-900 truncate flex items-center gap-2\">\n                <span className=\"truncate\">{ev.title}</span>\n                <div className={`w-2 h-2 rounded-full flex-shrink-0 ${eventTypeColor}`}></div>\n              </div>\n              <div className=\"text-sm text-gray-500 truncate\">{when}{ev.location ? ` · ${ev.location}` : ''}</div>\n            </div>\n            <button onClick={() => onDelete(ev.id)} className=\"btn-link text-sm\">Borrar</button>\n          </li>\n        );\n      })}\n    </ul>\n  );\n};\n\nexport default function CalendarPage() {\n  const [view, setView] = useState('Lista'); // 'Lista' | 'Calendario'\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const pairId = useMemo(() => localStorage.getItem('pairId') || '', []);\n  const identity = useMemo(() => localStorage.getItem('identity') || 'yo', []);\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshKey, setRefreshKey] = useState(0);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState('');\n  const [selectedEventType, setSelectedEventType] = useState('conjunto');\n  const [selectedDay, setSelectedDay] = useState(null);\n  const [dayEventsPopup, setDayEventsPopup] = useState(false);\n  const [showHeartRain, setShowHeartRain] = useState(false);\n  const [heartAnimationType, setHeartAnimationType] = useState('rain');\n\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      try {\n        const list = await listEvents(pairId, { futureOnly: false, max: 100 });\n        if (!cancelled) setItems(list);\n      } catch (e) {\n        if (!cancelled) setError('Sin conexión o sin permisos.');\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => { cancelled = true; };\n  }, [pairId, refreshKey]);\n\n  const { upcomingEvents, pastEvents } = useMemo(() => {\n    const now = new Date();\n    const upcoming = [];\n    const past = [];\n    const sortedItems = [...items].sort((a,b) => (a.start?.toMillis?.()||0) - (b.start?.toMillis?.()||0));\n\n    for (const event of sortedItems) {\n      if ((event.start?.toDate() || 0) >= now) {\n        upcoming.push(event);\n      } else {\n        past.push(event);\n      }\n    }\n    return { upcomingEvents: upcoming, pastEvents: past.reverse() };\n  }, [items]);\n\n  async function onAdd(e) {\n    e.preventDefault();\n    const { title, location, date, time, endDate } = Object.fromEntries(new FormData(e.currentTarget));\n    if (!title || !date) return;\n    setSaving(true);\n    setError('');\n    \n    // Call addEvent and close popup regardless of result\n    addEvent(pairId, { title, date, time, endDate, location, eventType: selectedEventType }, identity);\n    \n    e.currentTarget.reset();\n    setSelectedEventType('conjunto'); // Reset to default\n    setIsModalOpen(false);\n    setSaving(false);\n    setRefreshKey(k => k + 1); // Force a reliable refetch\n  }\n\n  const onDelete = async (id) => {\n    if (!window.confirm('¿Borrar evento?')) return;\n    try {\n      await deleteEvent(pairId, id);\n      setRefreshKey(k => k + 1);\n    } catch (e) {\n      alert('Error al borrar');\n    }\n  };\n\n  const onDayClick = (day, month, year) => {\n    setSelectedDay({ day, month, year });\n    setDayEventsPopup(true);\n    \n    // Special celebration for day 24 (anniversary day)\n    if (day === 24) {\n      setShowHeartRain(true);\n      // Stop animation after 2 seconds\n      setTimeout(() => setShowHeartRain(false), 2000);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <ViewSwitcher \n        views={['Lista', 'Calendario']}\n        activeView={view}\n        onChange={setView}\n      />\n\n      {view === 'Calendario' && <MonthlyCalendarView events={items} onDayClick={onDayClick} />}\n\n      {view === 'Lista' && (\n        <div className=\"relative min-h-[60vh]\">\n          <div className=\"divide-y divide-gray-200\">\n            <div className=\"card rounded-b-none\">\n              <CollapsibleSection title=\"Próximos eventos\" defaultOpen>\n                {loading ? <div className=\"text-gray-500 px-4 py-2\">Cargando…</div> : <EventList events={upcomingEvents} onDelete={onDelete} />}\n              </CollapsibleSection>\n            </div>\n            <div className=\"card rounded-t-none\">\n              <CollapsibleSection title=\"Eventos pasados\">\n                <EventList events={pastEvents} onDelete={onDelete} />\n              </CollapsibleSection>\n            </div>\n          </div>\n          <button onClick={() => setIsModalOpen(true)} className=\"fixed bottom-24 right-4 bg-rose-500 text-white rounded-full px-5 py-3 font-semibold shadow-lg hover:bg-rose-600 transition-transform active:scale-95\">\n            Nuevo evento\n          </button>\n        </div>\n      )}\n\n      <Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)}>\n        <form onSubmit={onAdd} className=\"p-6 space-y-4\">\n          <h3 className=\"font-semibold text-lg\">Añadir evento</h3>\n          <div className=\"space-y-3\">\n            <input name=\"title\" placeholder=\"Título\" className=\"input w-full\" required />\n            <input name=\"location\" placeholder=\"Ubicación (opcional)\" className=\"input w-full\" />\n            <div className=\"grid grid-cols-2 gap-3\">\n              <input name=\"date\" type=\"date\" className=\"input w-full\" required />\n              <input name=\"time\" type=\"time\" className=\"input w-full\" />\n            </div>\n            <input name=\"endDate\" type=\"date\" className=\"input w-full\" />\n            <div className=\"space-y-2\">\n              <label className=\"block text-sm text-gray-600\">Tipo de evento</label>\n              <EventTypeSwitcher \n                activeType={selectedEventType} \n                onChange={setSelectedEventType} \n              />\n            </div>\n          </div>\n          {error && <p className=\"text-xs text-rose-600\">{error}</p>}\n          <div className=\"flex justify-end gap-2\">\n            <button type=\"button\" onClick={() => setIsModalOpen(false)} className=\"btn-ghost\">Cancelar</button>\n            <button disabled={saving} className=\"btn-primary disabled:opacity-60\">{saving ? 'Guardando…' : 'Añadir'}</button>\n          </div>\n        </form>\n      </Modal>\n\n      <Modal isOpen={dayEventsPopup} onClose={() => setDayEventsPopup(false)}>\n        <div className=\"p-6\">\n          <h3 className=\"font-semibold text-lg mb-4\">\n            {selectedDay && `Eventos del ${selectedDay.day} de ${new Date(selectedDay.year, selectedDay.month).toLocaleDateString('es-ES', { month: 'long', year: 'numeric' })}`}\n          </h3>\n          {selectedDay && (() => {\n            // Special anniversary message for day 24\n            const isAnniversaryDay = selectedDay.day === 24;\n            let anniversaryMessage = null;\n            \n            if (isAnniversaryDay) {\n              const anniversaryDate = new Date(2024, 10, 24); // November 24, 2024 (month is 0-indexed)\n              const selectedDate = new Date(selectedDay.year, selectedDay.month, selectedDay.day);\n              \n              // Calculate months difference\n              const yearsDiff = selectedDate.getFullYear() - anniversaryDate.getFullYear();\n              const monthsDiff = selectedDate.getMonth() - anniversaryDate.getMonth();\n              const totalMonths = yearsDiff * 12 + monthsDiff;\n              \n              if (totalMonths > 0) {\n                let message = '';\n                if (totalMonths >= 12) {\n                  const years = Math.floor(totalMonths / 12);\n                  const remainingMonths = totalMonths % 12;\n                  if (remainingMonths === 0) {\n                    message = `¡¡${years} ${years === 1 ? 'año' : 'años'}!!`;\n                  } else {\n                    message = `¡¡${years} ${years === 1 ? 'año' : 'años'} y ${remainingMonths} ${remainingMonths === 1 ? 'mes' : 'meses'}!!`;\n                  }\n                } else {\n                  message = `¡¡${totalMonths} ${totalMonths === 1 ? 'mes' : 'meses'}!!`;\n                }\n                \n                anniversaryMessage = (\n                  <div className=\"bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-200 rounded-lg p-4 mb-4 text-center\">\n                    <div className=\"text-2xl mb-2\">💖</div>\n                    <div className=\"text-lg font-semibold text-pink-600 mb-1\">\n                      {message}\n                    </div>\n                    <div className=\"text-sm text-pink-500\">\n                      ¡Feliz mesiversario!\n                    </div>\n                  </div>\n                );\n              }\n            }\n            \n            // Filter events for the selected day\n            const dayEvents = items.filter(event => {\n              if (!event.start?.toDate) return false;\n              const eventStart = event.start.toDate();\n              const eventEnd = event.end?.toDate() || eventStart;\n              const selectedDate = new Date(selectedDay.year, selectedDay.month, selectedDay.day);\n              \n              // Check if the selected date falls within the event range\n              return selectedDate >= new Date(eventStart.getFullYear(), eventStart.getMonth(), eventStart.getDate()) &&\n                     selectedDate <= new Date(eventEnd.getFullYear(), eventEnd.getMonth(), eventEnd.getDate());\n            });\n\n            return (\n              <>\n                {anniversaryMessage}\n                {dayEvents.length > 0 ? (\n                  <EventList events={dayEvents} onDelete={onDelete} />\n                ) : (\n                  !anniversaryMessage && <div className=\"text-gray-500 text-sm py-4\">No hay eventos en este día.</div>\n                )}\n              </>\n            );\n          })()}\n          <div className=\"flex justify-end mt-4\">\n            <button onClick={() => setDayEventsPopup(false)} className=\"btn-primary\">Cerrar</button>\n          </div>\n        </div>\n      </Modal>\n      \n      <HeartRainAnimation isActive={showHeartRain} duration={2000} />\n    </div>\n  );\n}\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AAC3D,SAASC,QAAQ,EAAEC,UAAU,EAAEC,WAAW,QAAQ,iBAAiB;AACnE,OAAOC,KAAK,MAAM,qBAAqB;AACvC,OAAOC,iBAAiB,MAAM,iCAAiC;AAC/D,OAAOC,YAAY,MAAM,4BAA4B;AACrD,OAAOC,mBAAmB,MAAM,mCAAmC;AACnE,OAAOC,kBAAkB,MAAM,kCAAkC;AACjE,OAAOC,kBAAkB,MAAM,kCAAkC;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAElE,MAAMC,SAAS,GAAGA,CAAC;EAAEC,MAAM;EAAEC;AAAS,CAAC,KAAK;EAC1C,IAAID,MAAM,CAACE,MAAM,KAAK,CAAC,EAAE;IACvB,oBAAON,OAAA;MAAKO,SAAS,EAAC,iCAAiC;MAAAC,QAAA,EAAC;IAAoB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC;EACpF;EACA,oBACEZ,OAAA;IAAIO,SAAS,EAAC,0BAA0B;IAAAC,QAAA,EACrCJ,MAAM,CAACS,GAAG,CAAEC,EAAE,IAAK;MAAA,IAAAC,SAAA,EAAAC,gBAAA,EAAAC,OAAA,EAAAC,cAAA;MAClB,MAAMC,SAAS,GAAG,EAAAJ,SAAA,GAAAD,EAAE,CAACM,KAAK,cAAAL,SAAA,wBAAAC,gBAAA,GAARD,SAAA,CAAUM,MAAM,cAAAL,gBAAA,uBAAhBA,gBAAA,CAAAM,IAAA,CAAAP,SAAmB,CAAC,KAAI,IAAI;MAC9C,MAAMQ,OAAO,GAAG,EAAAN,OAAA,GAAAH,EAAE,CAACU,GAAG,cAAAP,OAAA,wBAAAC,cAAA,GAAND,OAAA,CAAQI,MAAM,cAAAH,cAAA,uBAAdA,cAAA,CAAAI,IAAA,CAAAL,OAAiB,CAAC,KAAI,IAAI;MAE1C,IAAIQ,IAAI,GAAG,EAAE;MACb,IAAIN,SAAS,EAAE;QACb,MAAMO,QAAQ,GAAGP,SAAS,CAACQ,cAAc,CAAC,EAAE,EAAE;UAAEC,SAAS,EAAE,QAAQ;UAAEC,SAAS,EAAE;QAAQ,CAAC,CAAC;QAC1F,IAAIN,OAAO,IAAIA,OAAO,CAACO,YAAY,CAAC,CAAC,KAAKX,SAAS,CAACW,YAAY,CAAC,CAAC,EAAE;UAClE;UACA,MAAMC,MAAM,GAAGR,OAAO,CAACI,cAAc,CAAC,EAAE,EAAE;YAAEC,SAAS,EAAE,QAAQ;YAAEC,SAAS,EAAE;UAAQ,CAAC,CAAC;UACtFJ,IAAI,GAAG,GAAGC,QAAQ,MAAMK,MAAM,EAAE;QAClC,CAAC,MAAM;UACL;UACAN,IAAI,GAAGC,QAAQ;QACjB;MACF;;MAEA;MACA,IAAIM,cAAc,GAAG,aAAa,CAAC,CAAC;MACpC,IAAIlB,EAAE,CAACmB,SAAS,KAAK,OAAO,EAAE;QAC5BD,cAAc,GAAG,eAAe;MAClC,CAAC,MAAM,IAAIlB,EAAE,CAACmB,SAAS,KAAK,OAAO,EAAE;QACnCD,cAAc,GAAG,eAAe;MAClC;MAEA,oBACEhC,OAAA;QAAgBO,SAAS,EAAC,8BAA8B;QAAAC,QAAA,gBACtDR,OAAA;UAAKO,SAAS,EAAC,gBAAgB;UAAAC,QAAA,gBAC7BR,OAAA;YAAKO,SAAS,EAAC,4DAA4D;YAAAC,QAAA,gBACzER,OAAA;cAAMO,SAAS,EAAC,UAAU;cAAAC,QAAA,EAAEM,EAAE,CAACoB;YAAK;cAAAzB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC5CZ,OAAA;cAAKO,SAAS,EAAE,sCAAsCyB,cAAc;YAAG;cAAAvB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC3E,CAAC,eACNZ,OAAA;YAAKO,SAAS,EAAC,gCAAgC;YAAAC,QAAA,GAAEiB,IAAI,EAAEX,EAAE,CAACqB,QAAQ,GAAG,MAAMrB,EAAE,CAACqB,QAAQ,EAAE,GAAG,EAAE;UAAA;YAAA1B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACjG,CAAC,eACNZ,OAAA;UAAQoC,OAAO,EAAEA,CAAA,KAAM/B,QAAQ,CAACS,EAAE,CAACuB,EAAE,CAAE;UAAC9B,SAAS,EAAC,kBAAkB;UAAAC,QAAA,EAAC;QAAM;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA,GAR7EE,EAAE,CAACuB,EAAE;QAAA5B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OASV,CAAC;IAET,CAAC;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACA,CAAC;AAET,CAAC;AAAC0B,EAAA,GA9CInC,SAAS;AAgDf,eAAe,SAASoC,YAAYA,CAAA,EAAG;EAAAC,EAAA;EACrC,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGrD,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;EAC3C,MAAM,CAACsD,WAAW,EAAEC,cAAc,CAAC,GAAGvD,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAMwD,MAAM,GAAGzD,OAAO,CAAC,MAAM0D,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC;EACtE,MAAMC,QAAQ,GAAG5D,OAAO,CAAC,MAAM0D,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,IAAI,IAAI,EAAE,EAAE,CAAC;EAC5E,MAAM,CAACE,KAAK,EAAEC,QAAQ,CAAC,GAAG7D,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAAC8D,OAAO,EAAEC,UAAU,CAAC,GAAG/D,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACgE,UAAU,EAAEC,aAAa,CAAC,GAAGjE,QAAQ,CAAC,CAAC,CAAC;EAC/C,MAAM,CAACkE,MAAM,EAAEC,SAAS,CAAC,GAAGnE,QAAQ,CAAC,KAAK,CAAC;EAC3C,MAAM,CAACoE,KAAK,EAAEC,QAAQ,CAAC,GAAGrE,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACsE,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGvE,QAAQ,CAAC,UAAU,CAAC;EACtE,MAAM,CAACwE,WAAW,EAAEC,cAAc,CAAC,GAAGzE,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAAC0E,cAAc,EAAEC,iBAAiB,CAAC,GAAG3E,QAAQ,CAAC,KAAK,CAAC;EAC3D,MAAM,CAAC4E,aAAa,EAAEC,gBAAgB,CAAC,GAAG7E,QAAQ,CAAC,KAAK,CAAC;EACzD,MAAM,CAAC8E,kBAAkB,EAAEC,qBAAqB,CAAC,GAAG/E,QAAQ,CAAC,MAAM,CAAC;EAEpEF,SAAS,CAAC,MAAM;IACd,IAAIkF,SAAS,GAAG,KAAK;IACrB,CAAC,YAAY;MACXjB,UAAU,CAAC,IAAI,CAAC;MAChB,IAAI;QACF,MAAMkB,IAAI,GAAG,MAAM/E,UAAU,CAACsD,MAAM,EAAE;UAAE0B,UAAU,EAAE,KAAK;UAAEC,GAAG,EAAE;QAAI,CAAC,CAAC;QACtE,IAAI,CAACH,SAAS,EAAEnB,QAAQ,CAACoB,IAAI,CAAC;MAChC,CAAC,CAAC,OAAOG,CAAC,EAAE;QACV,IAAI,CAACJ,SAAS,EAAEX,QAAQ,CAAC,8BAA8B,CAAC;MAC1D,CAAC,SAAS;QACR,IAAI,CAACW,SAAS,EAAEjB,UAAU,CAAC,KAAK,CAAC;MACnC;IACF,CAAC,EAAE,CAAC;IACJ,OAAO,MAAM;MAAEiB,SAAS,GAAG,IAAI;IAAE,CAAC;EACpC,CAAC,EAAE,CAACxB,MAAM,EAAEQ,UAAU,CAAC,CAAC;EAExB,MAAM;IAAEqB,cAAc;IAAEC;EAAW,CAAC,GAAGvF,OAAO,CAAC,MAAM;IACnD,MAAMwF,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC;IACtB,MAAMC,QAAQ,GAAG,EAAE;IACnB,MAAMC,IAAI,GAAG,EAAE;IACf,MAAMC,WAAW,GAAG,CAAC,GAAG/B,KAAK,CAAC,CAACgC,IAAI,CAAC,CAACC,CAAC,EAACC,CAAC;MAAA,IAAAC,QAAA,EAAAC,iBAAA,EAAAC,QAAA,EAAAC,iBAAA;MAAA,OAAK,CAAC,EAAAH,QAAA,GAAAF,CAAC,CAAC9D,KAAK,cAAAgE,QAAA,wBAAAC,iBAAA,GAAPD,QAAA,CAASI,QAAQ,cAAAH,iBAAA,uBAAjBA,iBAAA,CAAA/D,IAAA,CAAA8D,QAAoB,CAAC,KAAE,CAAC,KAAK,EAAAE,QAAA,GAAAH,CAAC,CAAC/D,KAAK,cAAAkE,QAAA,wBAAAC,iBAAA,GAAPD,QAAA,CAASE,QAAQ,cAAAD,iBAAA,uBAAjBA,iBAAA,CAAAjE,IAAA,CAAAgE,QAAoB,CAAC,KAAE,CAAC,CAAC;IAAA,EAAC;IAErG,KAAK,MAAMG,KAAK,IAAIT,WAAW,EAAE;MAAA,IAAAU,YAAA;MAC/B,IAAI,CAAC,EAAAA,YAAA,GAAAD,KAAK,CAACrE,KAAK,cAAAsE,YAAA,uBAAXA,YAAA,CAAarE,MAAM,CAAC,CAAC,KAAI,CAAC,KAAKuD,GAAG,EAAE;QACvCE,QAAQ,CAACa,IAAI,CAACF,KAAK,CAAC;MACtB,CAAC,MAAM;QACLV,IAAI,CAACY,IAAI,CAACF,KAAK,CAAC;MAClB;IACF;IACA,OAAO;MAAEf,cAAc,EAAEI,QAAQ;MAAEH,UAAU,EAAEI,IAAI,CAACa,OAAO,CAAC;IAAE,CAAC;EACjE,CAAC,EAAE,CAAC3C,KAAK,CAAC,CAAC;EAEX,eAAe4C,KAAKA,CAACpB,CAAC,EAAE;IACtBA,CAAC,CAACqB,cAAc,CAAC,CAAC;IAClB,MAAM;MAAE5D,KAAK;MAAEC,QAAQ;MAAE4D,IAAI;MAAEC,IAAI;MAAEzE;IAAQ,CAAC,GAAG0E,MAAM,CAACC,WAAW,CAAC,IAAIC,QAAQ,CAAC1B,CAAC,CAAC2B,aAAa,CAAC,CAAC;IAClG,IAAI,CAAClE,KAAK,IAAI,CAAC6D,IAAI,EAAE;IACrBvC,SAAS,CAAC,IAAI,CAAC;IACfE,QAAQ,CAAC,EAAE,CAAC;;IAEZ;IACApE,QAAQ,CAACuD,MAAM,EAAE;MAAEX,KAAK;MAAE6D,IAAI;MAAEC,IAAI;MAAEzE,OAAO;MAAEY,QAAQ;MAAEF,SAAS,EAAE0B;IAAkB,CAAC,EAAEX,QAAQ,CAAC;IAElGyB,CAAC,CAAC2B,aAAa,CAACC,KAAK,CAAC,CAAC;IACvBzC,oBAAoB,CAAC,UAAU,CAAC,CAAC,CAAC;IAClChB,cAAc,CAAC,KAAK,CAAC;IACrBY,SAAS,CAAC,KAAK,CAAC;IAChBF,aAAa,CAACgD,CAAC,IAAIA,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EAC7B;EAEA,MAAMjG,QAAQ,GAAG,MAAOgC,EAAE,IAAK;IAC7B,IAAI,CAACkE,MAAM,CAACC,OAAO,CAAC,iBAAiB,CAAC,EAAE;IACxC,IAAI;MACF,MAAMhH,WAAW,CAACqD,MAAM,EAAER,EAAE,CAAC;MAC7BiB,aAAa,CAACgD,CAAC,IAAIA,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC,CAAC,OAAO7B,CAAC,EAAE;MACVgC,KAAK,CAAC,iBAAiB,CAAC;IAC1B;EACF,CAAC;EAED,MAAMC,UAAU,GAAGA,CAACC,GAAG,EAAEC,KAAK,EAAEC,IAAI,KAAK;IACvC/C,cAAc,CAAC;MAAE6C,GAAG;MAAEC,KAAK;MAAEC;IAAK,CAAC,CAAC;IACpC7C,iBAAiB,CAAC,IAAI,CAAC;;IAEvB;IACA,IAAI2C,GAAG,KAAK,EAAE,EAAE;MACdzC,gBAAgB,CAAC,IAAI,CAAC;MACtB;MACA4C,UAAU,CAAC,MAAM5C,gBAAgB,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC;IACjD;EACF,CAAC;EAED,oBACElE,OAAA;IAAKO,SAAS,EAAC,WAAW;IAAAC,QAAA,gBACxBR,OAAA,CAACL,YAAY;MACXoH,KAAK,EAAE,CAAC,OAAO,EAAE,YAAY,CAAE;MAC/BC,UAAU,EAAEvE,IAAK;MACjBwE,QAAQ,EAAEvE;IAAQ;MAAAjC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACnB,CAAC,EAED6B,IAAI,KAAK,YAAY,iBAAIzC,OAAA,CAACJ,mBAAmB;MAACQ,MAAM,EAAE6C,KAAM;MAACyD,UAAU,EAAEA;IAAW;MAAAjG,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,EAEvF6B,IAAI,KAAK,OAAO,iBACfzC,OAAA;MAAKO,SAAS,EAAC,uBAAuB;MAAAC,QAAA,gBACpCR,OAAA;QAAKO,SAAS,EAAC,0BAA0B;QAAAC,QAAA,gBACvCR,OAAA;UAAKO,SAAS,EAAC,qBAAqB;UAAAC,QAAA,eAClCR,OAAA,CAACH,kBAAkB;YAACqC,KAAK,EAAC,qBAAkB;YAACgF,WAAW;YAAA1G,QAAA,EACrD2C,OAAO,gBAAGnD,OAAA;cAAKO,SAAS,EAAC,yBAAyB;cAAAC,QAAA,EAAC;YAAS;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CAAC,gBAAGZ,OAAA,CAACG,SAAS;cAACC,MAAM,EAAEsE,cAAe;cAACrE,QAAQ,EAAEA;YAAS;cAAAI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC7G;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClB,CAAC,eACNZ,OAAA;UAAKO,SAAS,EAAC,qBAAqB;UAAAC,QAAA,eAClCR,OAAA,CAACH,kBAAkB;YAACqC,KAAK,EAAC,iBAAiB;YAAA1B,QAAA,eACzCR,OAAA,CAACG,SAAS;cAACC,MAAM,EAAEuE,UAAW;cAACtE,QAAQ,EAAEA;YAAS;cAAAI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACnC;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClB,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eACNZ,OAAA;QAAQoC,OAAO,EAAEA,CAAA,KAAMQ,cAAc,CAAC,IAAI,CAAE;QAACrC,SAAS,EAAC,sJAAsJ;QAAAC,QAAA,EAAC;MAE9M;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CACN,eAEDZ,OAAA,CAACP,KAAK;MAAC0H,MAAM,EAAExE,WAAY;MAACyE,OAAO,EAAEA,CAAA,KAAMxE,cAAc,CAAC,KAAK,CAAE;MAAApC,QAAA,eAC/DR,OAAA;QAAMqH,QAAQ,EAAExB,KAAM;QAACtF,SAAS,EAAC,eAAe;QAAAC,QAAA,gBAC9CR,OAAA;UAAIO,SAAS,EAAC,uBAAuB;UAAAC,QAAA,EAAC;QAAa;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACxDZ,OAAA;UAAKO,SAAS,EAAC,WAAW;UAAAC,QAAA,gBACxBR,OAAA;YAAOsH,IAAI,EAAC,OAAO;YAACC,WAAW,EAAC,WAAQ;YAAChH,SAAS,EAAC,cAAc;YAACiH,QAAQ;UAAA;YAAA/G,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC7EZ,OAAA;YAAOsH,IAAI,EAAC,UAAU;YAACC,WAAW,EAAC,yBAAsB;YAAChH,SAAS,EAAC;UAAc;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eACrFZ,OAAA;YAAKO,SAAS,EAAC,wBAAwB;YAAAC,QAAA,gBACrCR,OAAA;cAAOsH,IAAI,EAAC,MAAM;cAACG,IAAI,EAAC,MAAM;cAAClH,SAAS,EAAC,cAAc;cAACiH,QAAQ;YAAA;cAAA/G,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eACnEZ,OAAA;cAAOsH,IAAI,EAAC,MAAM;cAACG,IAAI,EAAC,MAAM;cAAClH,SAAS,EAAC;YAAc;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACvD,CAAC,eACNZ,OAAA;YAAOsH,IAAI,EAAC,SAAS;YAACG,IAAI,EAAC,MAAM;YAAClH,SAAS,EAAC;UAAc;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC7DZ,OAAA;YAAKO,SAAS,EAAC,WAAW;YAAAC,QAAA,gBACxBR,OAAA;cAAOO,SAAS,EAAC,6BAA6B;cAAAC,QAAA,EAAC;YAAc;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eACrEZ,OAAA,CAACN,iBAAiB;cAChBgI,UAAU,EAAE/D,iBAAkB;cAC9BsD,QAAQ,EAAErD;YAAqB;cAAAnD,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAChC,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,EACL6C,KAAK,iBAAIzD,OAAA;UAAGO,SAAS,EAAC,uBAAuB;UAAAC,QAAA,EAAEiD;QAAK;UAAAhD,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eAC1DZ,OAAA;UAAKO,SAAS,EAAC,wBAAwB;UAAAC,QAAA,gBACrCR,OAAA;YAAQyH,IAAI,EAAC,QAAQ;YAACrF,OAAO,EAAEA,CAAA,KAAMQ,cAAc,CAAC,KAAK,CAAE;YAACrC,SAAS,EAAC,WAAW;YAAAC,QAAA,EAAC;UAAQ;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACnGZ,OAAA;YAAQ2H,QAAQ,EAAEpE,MAAO;YAAChD,SAAS,EAAC,iCAAiC;YAAAC,QAAA,EAAE+C,MAAM,GAAG,YAAY,GAAG;UAAQ;YAAA9C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAS,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC9G,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACF;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACF,CAAC,eAERZ,OAAA,CAACP,KAAK;MAAC0H,MAAM,EAAEpD,cAAe;MAACqD,OAAO,EAAEA,CAAA,KAAMpD,iBAAiB,CAAC,KAAK,CAAE;MAAAxD,QAAA,eACrER,OAAA;QAAKO,SAAS,EAAC,KAAK;QAAAC,QAAA,gBAClBR,OAAA;UAAIO,SAAS,EAAC,4BAA4B;UAAAC,QAAA,EACvCqD,WAAW,IAAI,eAAeA,WAAW,CAAC8C,GAAG,OAAO,IAAI9B,IAAI,CAAChB,WAAW,CAACgD,IAAI,EAAEhD,WAAW,CAAC+C,KAAK,CAAC,CAACgB,kBAAkB,CAAC,OAAO,EAAE;YAAEhB,KAAK,EAAE,MAAM;YAAEC,IAAI,EAAE;UAAU,CAAC,CAAC;QAAE;UAAApG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClK,CAAC,EACJiD,WAAW,IAAI,CAAC,MAAM;UACrB;UACA,MAAMgE,gBAAgB,GAAGhE,WAAW,CAAC8C,GAAG,KAAK,EAAE;UAC/C,IAAImB,kBAAkB,GAAG,IAAI;UAE7B,IAAID,gBAAgB,EAAE;YACpB,MAAME,eAAe,GAAG,IAAIlD,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;YAChD,MAAMmD,YAAY,GAAG,IAAInD,IAAI,CAAChB,WAAW,CAACgD,IAAI,EAAEhD,WAAW,CAAC+C,KAAK,EAAE/C,WAAW,CAAC8C,GAAG,CAAC;;YAEnF;YACA,MAAMsB,SAAS,GAAGD,YAAY,CAACE,WAAW,CAAC,CAAC,GAAGH,eAAe,CAACG,WAAW,CAAC,CAAC;YAC5E,MAAMC,UAAU,GAAGH,YAAY,CAACI,QAAQ,CAAC,CAAC,GAAGL,eAAe,CAACK,QAAQ,CAAC,CAAC;YACvE,MAAMC,WAAW,GAAGJ,SAAS,GAAG,EAAE,GAAGE,UAAU;YAE/C,IAAIE,WAAW,GAAG,CAAC,EAAE;cACnB,IAAIC,OAAO,GAAG,EAAE;cAChB,IAAID,WAAW,IAAI,EAAE,EAAE;gBACrB,MAAME,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACJ,WAAW,GAAG,EAAE,CAAC;gBAC1C,MAAMK,eAAe,GAAGL,WAAW,GAAG,EAAE;gBACxC,IAAIK,eAAe,KAAK,CAAC,EAAE;kBACzBJ,OAAO,GAAG,KAAKC,KAAK,IAAIA,KAAK,KAAK,CAAC,GAAG,KAAK,GAAG,MAAM,IAAI;gBAC1D,CAAC,MAAM;kBACLD,OAAO,GAAG,KAAKC,KAAK,IAAIA,KAAK,KAAK,CAAC,GAAG,KAAK,GAAG,MAAM,MAAMG,eAAe,IAAIA,eAAe,KAAK,CAAC,GAAG,KAAK,GAAG,OAAO,IAAI;gBAC1H;cACF,CAAC,MAAM;gBACLJ,OAAO,GAAG,KAAKD,WAAW,IAAIA,WAAW,KAAK,CAAC,GAAG,KAAK,GAAG,OAAO,IAAI;cACvE;cAEAP,kBAAkB,gBAChB9H,OAAA;gBAAKO,SAAS,EAAC,iGAAiG;gBAAAC,QAAA,gBAC9GR,OAAA;kBAAKO,SAAS,EAAC,eAAe;kBAAAC,QAAA,EAAC;gBAAE;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAK,CAAC,eACvCZ,OAAA;kBAAKO,SAAS,EAAC,0CAA0C;kBAAAC,QAAA,EACtD8H;gBAAO;kBAAA7H,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACL,CAAC,eACNZ,OAAA;kBAAKO,SAAS,EAAC,uBAAuB;kBAAAC,QAAA,EAAC;gBAEvC;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAK,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACH,CACN;YACH;UACF;;UAEA;UACA,MAAM+H,SAAS,GAAG1F,KAAK,CAAC2F,MAAM,CAACnD,KAAK,IAAI;YAAA,IAAAoD,aAAA,EAAAC,UAAA;YACtC,IAAI,GAAAD,aAAA,GAACpD,KAAK,CAACrE,KAAK,cAAAyH,aAAA,eAAXA,aAAA,CAAaxH,MAAM,GAAE,OAAO,KAAK;YACtC,MAAM0H,UAAU,GAAGtD,KAAK,CAACrE,KAAK,CAACC,MAAM,CAAC,CAAC;YACvC,MAAM2H,QAAQ,GAAG,EAAAF,UAAA,GAAArD,KAAK,CAACjE,GAAG,cAAAsH,UAAA,uBAATA,UAAA,CAAWzH,MAAM,CAAC,CAAC,KAAI0H,UAAU;YAClD,MAAMf,YAAY,GAAG,IAAInD,IAAI,CAAChB,WAAW,CAACgD,IAAI,EAAEhD,WAAW,CAAC+C,KAAK,EAAE/C,WAAW,CAAC8C,GAAG,CAAC;;YAEnF;YACA,OAAOqB,YAAY,IAAI,IAAInD,IAAI,CAACkE,UAAU,CAACb,WAAW,CAAC,CAAC,EAAEa,UAAU,CAACX,QAAQ,CAAC,CAAC,EAAEW,UAAU,CAACE,OAAO,CAAC,CAAC,CAAC,IAC/FjB,YAAY,IAAI,IAAInD,IAAI,CAACmE,QAAQ,CAACd,WAAW,CAAC,CAAC,EAAEc,QAAQ,CAACZ,QAAQ,CAAC,CAAC,EAAEY,QAAQ,CAACC,OAAO,CAAC,CAAC,CAAC;UAClG,CAAC,CAAC;UAEF,oBACEjJ,OAAA,CAAAE,SAAA;YAAAM,QAAA,GACGsH,kBAAkB,EAClBa,SAAS,CAACrI,MAAM,GAAG,CAAC,gBACnBN,OAAA,CAACG,SAAS;cAACC,MAAM,EAAEuI,SAAU;cAACtI,QAAQ,EAAEA;YAAS;cAAAI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,GAEpD,CAACkH,kBAAkB,iBAAI9H,OAAA;cAAKO,SAAS,EAAC,4BAA4B;cAAAC,QAAA,EAAC;YAA2B;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CACpG;UAAA,eACD,CAAC;QAEP,CAAC,EAAE,CAAC,eACJZ,OAAA;UAAKO,SAAS,EAAC,uBAAuB;UAAAC,QAAA,eACpCR,OAAA;YAAQoC,OAAO,EAAEA,CAAA,KAAM4B,iBAAiB,CAAC,KAAK,CAAE;YAACzD,SAAS,EAAC,aAAa;YAAAC,QAAA,EAAC;UAAM;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACrF,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD,CAAC,eAERZ,OAAA,CAACF,kBAAkB;MAACoJ,QAAQ,EAAEjF,aAAc;MAACkF,QAAQ,EAAE;IAAK;MAAA1I,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAC5D,CAAC;AAEV;AAAC4B,EAAA,CA/NuBD,YAAY;AAAA6G,GAAA,GAAZ7G,YAAY;AAAA,IAAAD,EAAA,EAAA8G,GAAA;AAAAC,YAAA,CAAA/G,EAAA;AAAA+G,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}