{"ast":null,"code":"import { db, auth, authReady } from './firebase';\nlet _fb;\nasync function fb() {\n  if (!_fb) {\n    const mod = await import('firebase/firestore');\n    _fb = mod;\n  }\n  return _fb;\n}\nasync function waitAuth(timeout = 1200) {\n  if (!authReady) return;\n  try {\n    await Promise.race([authReady, new Promise(res => setTimeout(res, timeout))]);\n  } catch {}\n}\nexport async function listEvents(pairId, {\n  futureOnly = true,\n  max = 50\n} = {}) {\n  if (!pairId || !db) return [];\n  await waitAuth();\n  const f = await fb();\n  const col = f.collection(db, 'pairs', pairId, 'events');\n  let q;\n  if (futureOnly) {\n    const now = f.Timestamp.fromDate(new Date());\n    q = f.query(col, f.where('start', '>=', now), f.orderBy('start', 'asc'), f.limit(max));\n  } else {\n    q = f.query(col, f.orderBy('start', 'asc'), f.limit(max));\n  }\n  const snap = await f.getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\nexport async function addEvent(pairId, {\n  title,\n  date,\n  time,\n  endDate,\n  location = ''\n}, identity = 'yo') {\n  if (!pairId || !db) throw new Error('missing-context');\n  await waitAuth();\n  const f = await fb();\n  if (!(auth !== null && auth !== void 0 && auth.currentUser)) throw new Error('no-auth');\n  const [y, m, d] = (date || '').split('-').map(Number);\n  let hh = 12,\n    mm = 0;\n  if (time && /^(\\d{1,2}):(\\d{2})$/.test(time)) {\n    const parts = time.split(':');\n    hh = Math.min(23, Math.max(0, Number(parts[0])));\n    mm = Math.min(59, Math.max(0, Number(parts[1])));\n  }\n  const startDate = new Date(y, (m || 1) - 1, d || 1, hh, mm, 0, 0);\n  const start = f.Timestamp.fromDate(startDate);\n  const payload = {\n    title: String(title || '').trim(),\n    location: String(location || '').trim(),\n    start,\n    createdAt: f.serverTimestamp(),\n    createdBy: auth.currentUser.uid,\n    identity\n  };\n  if (endDate) {\n    const [ey, em, ed] = (endDate || '').split('-').map(Number);\n    if (ey && em && ed) {\n      const finalDate = new Date(ey, em - 1, ed, 23, 59, 59, 999);\n      if (finalDate > startDate) {\n        payload.end = f.Timestamp.fromDate(finalDate);\n      }\n    }\n  }\n  const col = f.collection(db, 'pairs', pairId, 'events');\n  await f.addDoc(col, payload);\n}\nexport async function deleteEvent(pairId, id) {\n  if (!pairId || !id || !db) return;\n  await waitAuth();\n  const f = await fb();\n  if (!(auth !== null && auth !== void 0 && auth.currentUser)) throw new Error('no-auth');\n  const ref = f.doc(f.collection(db, 'pairs', pairId, 'events'), id);\n  await f.deleteDoc(ref);\n}","map":{"version":3,"names":["db","auth","authReady","_fb","fb","mod","waitAuth","timeout","Promise","race","res","setTimeout","listEvents","pairId","futureOnly","max","f","col","collection","q","now","Timestamp","fromDate","Date","query","where","orderBy","limit","snap","getDocs","docs","map","d","id","data","addEvent","title","date","time","endDate","location","identity","Error","currentUser","y","m","split","Number","hh","mm","test","parts","Math","min","startDate","start","payload","String","trim","createdAt","serverTimestamp","createdBy","uid","ey","em","ed","finalDate","end","addDoc","deleteEvent","ref","doc","deleteDoc"],"sources":["/Users/sebastianfornelli/XcodeProjects/Relacion/CascadeProjects/windsurf-project/client/src/lib/calendar.js"],"sourcesContent":["import { db, auth, authReady } from './firebase';\n\nlet _fb;\nasync function fb() {\n  if (!_fb) {\n    const mod = await import('firebase/firestore');\n    _fb = mod;\n  }\n  return _fb;\n}\n\nasync function waitAuth(timeout = 1200) {\n  if (!authReady) return;\n  try {\n    await Promise.race([\n      authReady,\n      new Promise((res) => setTimeout(res, timeout)),\n    ]);\n  } catch {}\n}\n\nexport async function listEvents(pairId, { futureOnly = true, max = 50 } = {}) {\n  if (!pairId || !db) return [];\n  await waitAuth();\n  const f = await fb();\n  const col = f.collection(db, 'pairs', pairId, 'events');\n  let q;\n  if (futureOnly) {\n    const now = f.Timestamp.fromDate(new Date());\n    q = f.query(col, f.where('start', '>=', now), f.orderBy('start', 'asc'), f.limit(max));\n  } else {\n    q = f.query(col, f.orderBy('start', 'asc'), f.limit(max));\n  }\n  const snap = await f.getDocs(q);\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\n}\n\nexport async function addEvent(pairId, { title, date, time, endDate, location = '' }, identity = 'yo') {\n  if (!pairId || !db) throw new Error('missing-context');\n  await waitAuth();\n  const f = await fb();\n  if (!auth?.currentUser) throw new Error('no-auth');\n  const [y, m, d] = (date || '').split('-').map(Number);\n  let hh = 12, mm = 0;\n  if (time && /^(\\d{1,2}):(\\d{2})$/.test(time)) {\n    const parts = time.split(':');\n    hh = Math.min(23, Math.max(0, Number(parts[0])));\n    mm = Math.min(59, Math.max(0, Number(parts[1])));\n  }\n  const startDate = new Date(y, (m || 1) - 1, d || 1, hh, mm, 0, 0);\n  const start = f.Timestamp.fromDate(startDate);\n  const payload = {\n    title: String(title || '').trim(),\n    location: String(location || '').trim(),\n    start,\n    createdAt: f.serverTimestamp(),\n    createdBy: auth.currentUser.uid,\n    identity,\n  };\n\n  if (endDate) {\n    const [ey, em, ed] = (endDate || '').split('-').map(Number);\n    if (ey && em && ed) {\n      const finalDate = new Date(ey, em - 1, ed, 23, 59, 59, 999);\n      if (finalDate > startDate) {\n        payload.end = f.Timestamp.fromDate(finalDate);\n      }\n    }\n  }\n  const col = f.collection(db, 'pairs', pairId, 'events');\n  await f.addDoc(col, payload);\n}\n\nexport async function deleteEvent(pairId, id) {\n  if (!pairId || !id || !db) return;\n  await waitAuth();\n  const f = await fb();\n  if (!auth?.currentUser) throw new Error('no-auth');\n  const ref = f.doc(f.collection(db, 'pairs', pairId, 'events'), id);\n  await f.deleteDoc(ref);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}