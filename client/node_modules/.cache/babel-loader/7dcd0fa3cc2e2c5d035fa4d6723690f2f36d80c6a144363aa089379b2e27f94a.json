{"ast":null,"code":"import { auth, db, storage, authReady } from './firebase';\nimport { getThumb, putThumb, getOrig, putOrig, pruneOrig } from './photoCache';\n\n// Helpers\nfunction genId() {\n  return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`.toUpperCase();\n}\nasync function fileToCanvas(file) {\n  const img = document.createElement('img');\n  img.decoding = 'async';\n  img.loading = 'eager';\n  const url = URL.createObjectURL(file);\n  try {\n    await new Promise((res, rej) => {\n      img.onload = () => res();\n      img.onerror = rej;\n      img.src = url;\n    });\n  } finally {\n    URL.revokeObjectURL(url);\n  }\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  return {\n    img,\n    canvas,\n    ctx\n  };\n}\nfunction drawContain(img, max) {\n  const ratio = Math.min(max / img.width, max / img.height, 1);\n  const w = Math.round(img.width * ratio);\n  const h = Math.round(img.height * ratio);\n  return {\n    w,\n    h\n  };\n}\n\n// Wait for anonymous auth to be ready (avoid first-operation race)\nasync function waitAuth(timeout = 1200) {\n  if (!authReady) return;\n  try {\n    await Promise.race([authReady, new Promise(resolve => setTimeout(resolve, timeout))]);\n  } catch {}\n}\nasync function resizeToBlob(file, maxSize, quality = 0.85) {\n  const {\n    img,\n    canvas,\n    ctx\n  } = await fileToCanvas(file);\n  const {\n    w,\n    h\n  } = drawContain(img, maxSize);\n  canvas.width = w;\n  canvas.height = h;\n  ctx.drawImage(img, 0, 0, w, h);\n  const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', quality));\n  return blob;\n}\n\n// Local fallback store for metadata\nfunction localKey(pairId) {\n  return `photos:${pairId}`;\n}\nfunction readLocalMeta(pairId) {\n  try {\n    return JSON.parse(localStorage.getItem(localKey(pairId)) || '[]');\n  } catch {\n    return [];\n  }\n}\nfunction writeLocalMeta(pairId, arr) {\n  try {\n    localStorage.setItem(localKey(pairId), JSON.stringify(arr));\n  } catch {}\n}\n\n// Firebase imports lazy to avoid bundling when not needed\nlet _fb;\nasync function fb() {\n  if (!_fb) {\n    try {\n      const {\n        ref,\n        uploadBytes,\n        getDownloadURL\n      } = await import('firebase/storage');\n      const {\n        collection,\n        doc,\n        setDoc,\n        getDocs,\n        query,\n        orderBy,\n        limit,\n        serverTimestamp\n      } = await import('firebase/firestore');\n      _fb = {\n        ref,\n        uploadBytes,\n        getDownloadURL,\n        collection,\n        doc,\n        setDoc,\n        getDocs,\n        query,\n        orderBy,\n        limit,\n        serverTimestamp\n      };\n    } catch (e) {\n      _fb = null;\n    }\n  }\n  return _fb;\n}\nexport async function listPhotos(pairId, max = 100) {\n  const items = [];\n  const fblib = await fb();\n  if (db && fblib) {\n    try {\n      await waitAuth();\n      const {\n        collection,\n        getDocs,\n        query,\n        orderBy,\n        limit\n      } = fblib;\n      const col = collection(db, 'pairs', pairId, 'photos');\n      const q = query(col, orderBy('createdAt', 'desc'), limit(max));\n      const snap = await getDocs(q);\n      for (const docSnap of snap.docs) {\n        var _docSnap$data$created, _docSnap$data$created2;\n        const id = docSnap.id;\n        // try cached thumb first\n        let thumbUrl = '';\n        const blob = await getThumb(id);\n        if (blob) {\n          thumbUrl = URL.createObjectURL(blob);\n        } else {\n          // fetch from storage and cache\n          try {\n            const {\n              ref,\n              getDownloadURL\n            } = fblib;\n            const tRef = ref(storage, `pairs/${pairId}/photos/${id}/thumb.jpg`);\n            const url = await getDownloadURL(tRef);\n            const resp = await fetch(url);\n            const b = await resp.blob();\n            await putThumb(id, b);\n            thumbUrl = URL.createObjectURL(b);\n          } catch {}\n        }\n        items.push({\n          id,\n          thumbUrl,\n          createdAt: ((_docSnap$data$created = docSnap.data().createdAt) === null || _docSnap$data$created === void 0 ? void 0 : (_docSnap$data$created2 = _docSnap$data$created.toMillis) === null || _docSnap$data$created2 === void 0 ? void 0 : _docSnap$data$created2.call(_docSnap$data$created)) || Date.now()\n        });\n      }\n      return items;\n    } catch (e) {\n      // Fall back to local\n    }\n  }\n  // Local-only\n  const meta = readLocalMeta(pairId);\n  for (const m of meta) {\n    const b = await getThumb(m.id);\n    const thumbUrl = b ? URL.createObjectURL(b) : '';\n    items.push({\n      id: m.id,\n      thumbUrl,\n      createdAt: m.createdAt\n    });\n  }\n  // Sort desc by createdAt\n  items.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));\n  return items.slice(0, max);\n}\nexport async function getOriginal(pairId, id) {\n  const cached = await getOrig(id);\n  if (cached) return cached;\n  const fblib = await fb();\n  if (storage && fblib) {\n    try {\n      await waitAuth();\n      const {\n        ref,\n        getDownloadURL\n      } = fblib;\n      const oRef = ref(storage, `pairs/${pairId}/photos/${id}/orig.jpg`);\n      const url = await getDownloadURL(oRef);\n      const resp = await fetch(url);\n      const blob = await resp.blob();\n      await putOrig(id, blob);\n      await pruneOrig(20);\n      return blob;\n    } catch {}\n  }\n  return null;\n}\nexport async function uploadPhoto(pairId, file, identity = 'yo') {\n  const id = genId();\n  // make derivatives\n  const thumbBlob = await resizeToBlob(file, 480, 0.8);\n  const origBlob = await resizeToBlob(file, 1600, 0.9);\n\n  // cache locally\n  await putThumb(id, thumbBlob);\n  await putOrig(id, origBlob);\n  await pruneOrig(20);\n  const now = Date.now();\n  let remoteOk = false;\n  const fblib = await fb();\n  if (db && storage && fblib) {\n    try {\n      if (authReady) await authReady;\n      if (!(auth !== null && auth !== void 0 && auth.currentUser)) throw new Error('no-auth');\n      const {\n        ref,\n        uploadBytes,\n        collection,\n        doc,\n        setDoc,\n        serverTimestamp\n      } = fblib;\n      const base = `pairs/${pairId}/photos/${id}`;\n      await uploadBytes(ref(storage, `${base}/thumb.jpg`), thumbBlob, {\n        contentType: 'image/jpeg'\n      });\n      await uploadBytes(ref(storage, `${base}/orig.jpg`), origBlob, {\n        contentType: 'image/jpeg'\n      });\n      await setDoc(doc(collection(db, 'pairs', pairId, 'photos'), id), {\n        createdAt: serverTimestamp(),\n        createdBy: auth.currentUser.uid,\n        identity\n      });\n      remoteOk = true;\n    } catch (e) {\n      // ignore, we already cached locally\n    }\n  }\n\n  // local meta\n  const meta = readLocalMeta(pairId);\n  meta.push({\n    id,\n    createdAt: now,\n    identity\n  });\n  writeLocalMeta(pairId, meta);\n  return {\n    id,\n    thumbUrl: URL.createObjectURL(thumbBlob),\n    createdAt: now,\n    remote: remoteOk\n  };\n}","map":{"version":3,"names":["auth","db","storage","authReady","getThumb","putThumb","getOrig","putOrig","pruneOrig","genId","Date","now","toString","Math","random","slice","toUpperCase","fileToCanvas","file","img","document","createElement","decoding","loading","url","URL","createObjectURL","Promise","res","rej","onload","onerror","src","revokeObjectURL","canvas","ctx","getContext","drawContain","max","ratio","min","width","height","w","round","h","waitAuth","timeout","race","resolve","setTimeout","resizeToBlob","maxSize","quality","drawImage","blob","toBlob","localKey","pairId","readLocalMeta","JSON","parse","localStorage","getItem","writeLocalMeta","arr","setItem","stringify","_fb","fb","ref","uploadBytes","getDownloadURL","collection","doc","setDoc","getDocs","query","orderBy","limit","serverTimestamp","e","listPhotos","items","fblib","col","q","snap","docSnap","docs","_docSnap$data$created","_docSnap$data$created2","id","thumbUrl","tRef","resp","fetch","b","push","createdAt","data","toMillis","call","meta","m","sort","a","getOriginal","cached","oRef","uploadPhoto","identity","thumbBlob","origBlob","remoteOk","currentUser","Error","base","contentType","createdBy","uid","remote"],"sources":["/Users/sebastianfornelli/XcodeProjects/Relacion/CascadeProjects/windsurf-project/client/src/lib/photos.js"],"sourcesContent":["import { auth, db, storage, authReady } from './firebase';\nimport { getThumb, putThumb, getOrig, putOrig, pruneOrig } from './photoCache';\n\n// Helpers\nfunction genId() {\n  return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`.toUpperCase();\n}\n\nasync function fileToCanvas(file) {\n  const img = document.createElement('img');\n  img.decoding = 'async';\n  img.loading = 'eager';\n  const url = URL.createObjectURL(file);\n  try {\n    await new Promise((res, rej) => { img.onload = () => res(); img.onerror = rej; img.src = url; });\n  } finally {\n    URL.revokeObjectURL(url);\n  }\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  return { img, canvas, ctx };\n}\n\nfunction drawContain(img, max) {\n  const ratio = Math.min(max / img.width, max / img.height, 1);\n  const w = Math.round(img.width * ratio);\n  const h = Math.round(img.height * ratio);\n  return { w, h };\n}\n\n// Wait for anonymous auth to be ready (avoid first-operation race)\nasync function waitAuth(timeout = 1200) {\n  if (!authReady) return;\n  try {\n    await Promise.race([\n      authReady,\n      new Promise((resolve) => setTimeout(resolve, timeout)),\n    ]);\n  } catch {}\n}\n\nasync function resizeToBlob(file, maxSize, quality = 0.85) {\n  const { img, canvas, ctx } = await fileToCanvas(file);\n  const { w, h } = drawContain(img, maxSize);\n  canvas.width = w; canvas.height = h;\n  ctx.drawImage(img, 0, 0, w, h);\n  const blob = await new Promise((resolve) => canvas.toBlob(resolve, 'image/jpeg', quality));\n  return blob;\n}\n\n// Local fallback store for metadata\nfunction localKey(pairId) { return `photos:${pairId}`; }\nfunction readLocalMeta(pairId) {\n  try { return JSON.parse(localStorage.getItem(localKey(pairId)) || '[]'); } catch { return []; }\n}\nfunction writeLocalMeta(pairId, arr) {\n  try { localStorage.setItem(localKey(pairId), JSON.stringify(arr)); } catch {}\n}\n\n// Firebase imports lazy to avoid bundling when not needed\nlet _fb;\nasync function fb() {\n  if (!_fb) {\n    try {\n      const { ref, uploadBytes, getDownloadURL } = await import('firebase/storage');\n      const { collection, doc, setDoc, getDocs, query, orderBy, limit, serverTimestamp } = await import('firebase/firestore');\n      _fb = { ref, uploadBytes, getDownloadURL, collection, doc, setDoc, getDocs, query, orderBy, limit, serverTimestamp };\n    } catch (e) {\n      _fb = null;\n    }\n  }\n  return _fb;\n}\n\nexport async function listPhotos(pairId, max = 100) {\n  const items = [];\n  const fblib = await fb();\n  if (db && fblib) {\n    try {\n      await waitAuth();\n      const { collection, getDocs, query, orderBy, limit } = fblib;\n      const col = collection(db, 'pairs', pairId, 'photos');\n      const q = query(col, orderBy('createdAt', 'desc'), limit(max));\n      const snap = await getDocs(q);\n      for (const docSnap of snap.docs) {\n        const id = docSnap.id;\n        // try cached thumb first\n        let thumbUrl = '';\n        const blob = await getThumb(id);\n        if (blob) {\n          thumbUrl = URL.createObjectURL(blob);\n        } else {\n          // fetch from storage and cache\n          try {\n            const { ref, getDownloadURL } = fblib;\n            const tRef = ref(storage, `pairs/${pairId}/photos/${id}/thumb.jpg`);\n            const url = await getDownloadURL(tRef);\n            const resp = await fetch(url);\n            const b = await resp.blob();\n            await putThumb(id, b);\n            thumbUrl = URL.createObjectURL(b);\n          } catch {}\n        }\n        items.push({ id, thumbUrl, createdAt: docSnap.data().createdAt?.toMillis?.() || Date.now() });\n      }\n      return items;\n    } catch (e) {\n      // Fall back to local\n    }\n  }\n  // Local-only\n  const meta = readLocalMeta(pairId);\n  for (const m of meta) {\n    const b = await getThumb(m.id);\n    const thumbUrl = b ? URL.createObjectURL(b) : '';\n    items.push({ id: m.id, thumbUrl, createdAt: m.createdAt });\n  }\n  // Sort desc by createdAt\n  items.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));\n  return items.slice(0, max);\n}\n\nexport async function getOriginal(pairId, id) {\n  const cached = await getOrig(id);\n  if (cached) return cached;\n  const fblib = await fb();\n  if (storage && fblib) {\n    try {\n      await waitAuth();\n      const { ref, getDownloadURL } = fblib;\n      const oRef = ref(storage, `pairs/${pairId}/photos/${id}/orig.jpg`);\n      const url = await getDownloadURL(oRef);\n      const resp = await fetch(url);\n      const blob = await resp.blob();\n      await putOrig(id, blob);\n      await pruneOrig(20);\n      return blob;\n    } catch {}\n  }\n  return null;\n}\n\nexport async function uploadPhoto(pairId, file, identity = 'yo') {\n  const id = genId();\n  // make derivatives\n  const thumbBlob = await resizeToBlob(file, 480, 0.8);\n  const origBlob = await resizeToBlob(file, 1600, 0.9);\n\n  // cache locally\n  await putThumb(id, thumbBlob);\n  await putOrig(id, origBlob);\n  await pruneOrig(20);\n\n  const now = Date.now();\n  let remoteOk = false;\n\n  const fblib = await fb();\n  if (db && storage && fblib) {\n    try {\n      if (authReady) await authReady;\n      if (!auth?.currentUser) throw new Error('no-auth');\n      const { ref, uploadBytes, collection, doc, setDoc, serverTimestamp } = fblib;\n      const base = `pairs/${pairId}/photos/${id}`;\n      await uploadBytes(ref(storage, `${base}/thumb.jpg`), thumbBlob, { contentType: 'image/jpeg' });\n      await uploadBytes(ref(storage, `${base}/orig.jpg`), origBlob, { contentType: 'image/jpeg' });\n      await setDoc(doc(collection(db, 'pairs', pairId, 'photos'), id), {\n        createdAt: serverTimestamp(),\n        createdBy: auth.currentUser.uid,\n        identity,\n      });\n      remoteOk = true;\n    } catch (e) {\n      // ignore, we already cached locally\n    }\n  }\n\n  // local meta\n  const meta = readLocalMeta(pairId);\n  meta.push({ id, createdAt: now, identity });\n  writeLocalMeta(pairId, meta);\n\n  return { id, thumbUrl: URL.createObjectURL(thumbBlob), createdAt: now, remote: remoteOk };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}