@tailwind base;
@tailwind components;
@tailwind utilities;

/* Fix iOS overscroll background color: match app rose tint */
html, body {
  background-color: rgba(255, 241, 242, 0.5) !important; /* tailwind rose-50/50 */
}

body {
  overscroll-behavior: none;
}

/* Ensure bounce shows rosy tint even when container overscrolls */
.app-shell, .app-scroll {
  background-color: rgba(255, 241, 242, 0.5);
}

:root { 
  color-scheme: light; 
  --navbar-height: 4rem; /* 64px */
}

html, body, #root { height: 100%; }

body { @apply bg-rose-50/50; }

/***** Tipografía *****/
@layer base {
  h1, h2, h3 { @apply text-gray-900; }
  p { @apply text-gray-700; }
}

/* Componentes reutilizables para visual más profesional */
@layer components {
  .card { @apply bg-white/90 rounded-2xl p-4 border border-rose-100 shadow-sm; }
  .input { @apply rounded-xl border border-rose-200 px-3 py-2 outline-none focus:ring-2 focus:ring-rose-300; }
  .btn-primary { @apply inline-flex items-center justify-center px-3 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-500 active:scale-[0.99] transition; }
  .btn-ghost { @apply inline-flex items-center justify-center px-3 py-2 rounded-lg bg-rose-50 text-rose-700 hover:bg-rose-100; }
  .btn-link { @apply text-rose-600 hover:underline; }
  .chip { @apply inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-rose-50 text-rose-700 text-xs border border-rose-100; }
  .title-sm { @apply font-semibold text-gray-900; }
  .muted { @apply text-gray-500; }

  /* Rich text editor & note content basic typography */
  .rte a, .note-content a { @apply text-rose-600 underline; }
  .rte ul, .note-content ul { @apply list-disc pl-5; }
  .rte ol, .note-content ol { @apply list-decimal pl-5; }
  /* Ensure lists render bullets/numbers in card previews (inside to avoid clamp clipping) */
  .note-card ul, .note-snippet ul { @apply list-disc list-inside pl-5; }
  .note-card ol, .note-snippet ol { @apply list-decimal list-inside pl-5; }
  /* In the notes grid cards, keep link styling but disable click */
  .note-card a { pointer-events: none; cursor: default; }
  /* Break long words/URLs so they don't overflow */
  .note-card, .note-card *, .note-snippet, .note-snippet * {
    overflow-wrap: anywhere;
    word-break: break-word;
    hyphens: auto;
    min-width: 0;
  }
  /* Ensure titles and all content in notes grid also wrap */
  .masonry-grid .card, .masonry-grid .card * {
    overflow-wrap: anywhere;
    word-break: break-word;
    hyphens: auto;
    min-width: 0;
  }
  /* Note detail and thread message content wrapping */
  .note-content, .note-content * {
    overflow-wrap: anywhere;
    word-break: break-word;
    hyphens: auto;
    min-width: 0;
  }
  /* Let previews grow naturally (no gradient/clamp) */
  .note-snippet { 
    font-size: 0.875rem; 
    line-height: 1.25rem; 
  }
  /* Masonry layout: two columns with variable card heights */
  .masonry { 
    column-count: 2; 
    column-gap: 12px; 
    column-fill: balance;
  }
  .masonry .card { 
    break-inside: avoid; 
    -webkit-column-break-inside: avoid; 
    margin-bottom: 12px; 
    width: 100%; 
    display: inline-block;
  }

  /* Stacked thread wrapper to avoid iOS column clipping */
  .masonry .stack-wrapper {
    break-inside: avoid;
    -webkit-column-break-inside: avoid;
    page-break-inside: avoid;
    display: inline-block;
    width: 100%;
    margin-bottom: 12px; /* match card spacing */
    position: relative;
    overflow: visible; /* ensure stack shadows are visible */
  }
  .masonry .stack-wrapper .card {
    margin-bottom: 0 !important; /* prevent double spacing inside wrapper */
  }

  /* New flex-based masonry grid (stable reflow) */
  .masonry-grid { display: flex; gap: 12px; align-items: flex-start; }
  .masonry-col { flex: 1 1 0%; display: flex; flex-direction: column; gap: 12px; min-width: 0; }

  /* Safe-area helpers and FAB placement */
  .navbar-safe { padding-bottom: env(safe-area-inset-bottom); }
  .fab { position: fixed; right: 1rem; bottom: calc(4rem + env(safe-area-inset-bottom) + 0.75rem); z-index: 50; }

  /* Content bottom padding accounting for navbar (h-16 ~ 4rem) + extra + safe area */
  .pb-safe-content { padding-bottom: 170px; }

  /* Disable scrolling for pages that opt-in (Roulette) */
  .app-scroll.no-scroll {
    overflow: hidden !important;
  }



  /* Spacer div to push content up from the bottom navbar */
  .scroll-spacer {
    height: 170px; /* Manual override for iOS */
    flex-shrink: 0; /* Prevents the spacer from shrinking in a flex container */
  }

  /* Extra spacer for pages with a FAB, adds FAB height (3.5rem) */
  .fab-spacer {
    height: 3.5rem; /* 56px */
    flex-shrink: 0;
  }
}

/* Hide scrollbars on mobile (touch devices) */
@media (hover: none) and (pointer: coarse) {
  /* Hide viewport scrollbar by preventing body scroll */
  html, body { overflow: hidden; }

  /* App wrapper fixed to viewport; inner container will scroll */
  .app-shell { position: fixed; inset: 0; width: 100%; height: 100dvh; overflow: hidden; }

  /* Firefox */
  * { scrollbar-width: none; }
  /* IE/Edge legacy */
  * { -ms-overflow-style: none; }
  /* WebKit (iOS Safari, Chrome Android) */
  *::-webkit-scrollbar { display: none; width: 0; height: 0; }

  /* Inner app scroll container with momentum scrolling */
  .app-scroll { 
    height: 100%; 
    overflow-y: auto; 
    -webkit-overflow-scrolling: touch; 
    overscroll-behavior: contain;
    scrollbar-width: none; 
  }
  .app-scroll::-webkit-scrollbar { display: none; width: 0; height: 0; }
}

/* Extra guard for iOS Safari */
@supports (-webkit-touch-callout: none) {
  html, body { overflow: hidden; }
  .app-shell { position: fixed; inset: 0; width: 100%; height: 100dvh; overflow: hidden; }
  .app-scroll {
    /* Hide scrollbar on mobile while keeping functionality */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* Internet Explorer 10+ */
    /* Reduce rubber-band effect on iOS */
    -webkit-overflow-scrolling: auto;
    overscroll-behavior-y: contain;
  }

  .app-scroll::-webkit-scrollbar {
    display: none; /* WebKit */
  }

  /* Scroll spacer to ensure content is not hidden behind fixed navbar on iOS */
  .scroll-spacer {
    height: 170px; /* Fixed height to guarantee space on all iOS devices */
    flex-shrink: 0;
  }

  /* FAB spacer for pages with floating action button */
  .fab-spacer {
    height: 3.5rem; /* 56px - height of FAB button */
    flex-shrink: 0;
  }
}
